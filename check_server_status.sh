#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ VPN_BOT

 

echo "======================================"

echo "–ü–†–û–í–ï–†–ö–ê –°–û–°–¢–û–Ø–ù–ò–Ø –°–ï–†–í–ï–†–ê VPN_BOT"

echo "======================================"

echo ""

 

# –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è

echo "üìÅ –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:"

pwd

echo ""

 

# Git —Å—Ç–∞—Ç—É—Å

echo "======================================"

echo "üìä GIT STATUS"

echo "======================================"

git status

echo ""

 

# –¢–µ–∫—É—â–∞—è –≤–µ—Ç–∫–∞

echo "======================================"

echo "üåø –¢–ï–ö–£–©–ê–Ø –í–ï–¢–ö–ê"

echo "======================================"

git branch

echo ""

 

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã

echo "======================================"

echo "üìú –ü–û–°–õ–ï–î–ù–ò–ï 5 –ö–û–ú–ú–ò–¢–û–í"

echo "======================================"

git log --oneline -5

echo ""

 

# –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

echo "======================================"

echo "‚úèÔ∏è –õ–û–ö–ê–õ–¨–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø (git diff)"

echo "======================================"

if [ -z "$(git diff)" ]; then

    echo "–ù–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π"

else

    git diff --stat

    echo ""

    echo "–î–µ—Ç–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π:"

    git diff

fi

echo ""

 

# –ù–µ–ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

echo "======================================"

echo "‚ùì –ù–ï–ü–†–û–ò–ù–î–ï–ö–°–ò–†–û–í–ê–ù–ù–´–ï –§–ê–ô–õ–´"

echo "======================================"

git ls-files --others --exclude-standard

echo ""

 

# Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

echo "======================================"

echo "üê≥ DOCKER –ö–û–ù–¢–ï–ô–ù–ï–†–´"

echo "======================================"

docker ps

echo ""

 

# –õ–æ–≥–∏ –±–æ—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫)

echo "======================================"

echo "üìã –ü–û–°–õ–ï–î–ù–ò–ï –õ–û–ì–ò –ë–û–¢–ê"

echo "======================================"

docker compose logs --tail=20 vpn_hub_bot

echo ""

 

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –∏–∑–º–µ–Ω–∏–ª–∏

echo "======================================"

echo "üîç –ü–†–û–í–ï–†–ö–ê –ò–ó–ú–ï–ù–ï–ù–ù–´–• –§–ê–ô–õ–û–í"

echo "======================================"

 

files=(

    "bot/database/methods/get.py"

    "bot/handlers/admin/main.py"

    "bot/keyboards/inline/admin_inline.py"

    "bot/misc/callbackData.py"

)

 

for file in "${files[@]}"; do

    echo "--- $file ---"

    if [ -f "$file" ]; then

        echo "‚úÖ –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

        if [[ "$file" == *"get.py" ]]; then

            if grep -q "get_users_by_server_and_vpn_type" "$file"; then

                echo "‚úÖ –§—É–Ω–∫—Ü–∏—è get_users_by_server_and_vpn_type –Ω–∞–π–¥–µ–Ω–∞"

            else

                echo "‚ùå –§—É–Ω–∫—Ü–∏—è get_users_by_server_and_vpn_type –ù–ï –Ω–∞–π–¥–µ–Ω–∞"

            fi

        fi

        if [[ "$file" == *"admin_inline.py" ]]; then

            if grep -q "vpn_type_selection_menu" "$file"; then

                echo "‚úÖ –§—É–Ω–∫—Ü–∏—è vpn_type_selection_menu –Ω–∞–π–¥–µ–Ω–∞"

            else

                echo "‚ùå –§—É–Ω–∫—Ü–∏—è vpn_type_selection_menu –ù–ï –Ω–∞–π–¥–µ–Ω–∞"

            fi

        fi

    else

        echo "‚ùå –§–∞–π–ª –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"

    fi

    echo ""

done

 

echo "======================================"

echo "‚úÖ –ü–†–û–í–ï–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê"

echo "======================================"
