{% extends "base.html" %}
{% block title %}–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ - NoBorder VPN{% endblock %}

{% block content %}
<h1 class="page-title">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h1>
<p class="page-subtitle">–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ</p>

<!-- Referral Link -->
<div class="card">
    <div class="card-title" style="margin-bottom:12px">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</div>
    <div class="url-box" onclick="copyText('{{ referral.referral_link }}')">{{ referral.referral_link }}</div>
    <button class="btn btn-primary btn-sm" onclick="copyText('{{ referral.referral_link }}')">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
</div>

<!-- Stats -->
<div class="card">
    <div class="stat-row">
        <div class="stat-icon">üë•</div>
        <div class="stat-info">
            <div class="stat-label">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π</div>
            <div class="stat-value">{{ referral.total_invited }}</div>
        </div>
    </div>
    <div class="stat-row">
        <div class="stat-icon">üí∞</div>
        <div class="stat-info">
            <div class="stat-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –≤—Å–µ–≥–æ</div>
            <div class="stat-value">{{ referral.total_earned }}‚ÇΩ</div>
        </div>
    </div>
    <div class="stat-row">
        <div class="stat-icon">üíé</div>
        <div class="stat-info">
            <div class="stat-label">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—ã–≤–æ–¥–∞</div>
            <div class="stat-value" style="color:var(--accent)">{{ referral.referral_balance }}‚ÇΩ</div>
        </div>
    </div>
</div>

<!-- How it works -->
<div class="card" style="font-size:14px;color:var(--text-secondary);line-height:1.8">
    <div style="font-weight:600;color:var(--text-primary);margin-bottom:8px">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
    1. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–≥–æ–º<br>
    2. –î—Ä—É–≥ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∏ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É<br>
    3. –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ {{ referral.minimum_withdrawal // 100 * 50 // 20 }}% –æ—Ç –∫–∞–∂–¥–æ–π –æ–ø–ª–∞—Ç—ã<br>
    4. –í—ã–≤–æ–¥–∏—Ç–µ –æ—Ç {{ referral.minimum_withdrawal }}‚ÇΩ
</div>

<!-- Withdrawal -->
{% if referral.referral_balance >= referral.minimum_withdrawal %}
<div class="section-header">
    <span class="section-title">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</span>
</div>

<div class="card" x-data="{ amount: {{ referral.referral_balance }}, info: '', comm: '', loading: false }">
    <div class="form-group">
        <label class="form-label">–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞ (–º–∏–Ω. {{ referral.minimum_withdrawal }}‚ÇΩ)</label>
        <input type="number" class="form-input" x-model="amount" min="{{ referral.minimum_withdrawal }}" max="{{ referral.referral_balance }}">
    </div>
    <div class="form-group">
        <label class="form-label">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞</label>
        <input type="text" class="form-input" x-model="info" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã, –∫–æ—à–µ–ª–µ–∫ –∏ —Ç.–¥.">
    </div>
    <div class="form-group">
        <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
        <input type="text" class="form-input" x-model="comm" placeholder="Telegram, email">
    </div>
    <button class="btn btn-primary"
            :disabled="loading || !info || amount < {{ referral.minimum_withdrawal }}"
            @click="
                loading = true;
                fetch('/api/v1/referral/withdraw', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({amount: parseInt(amount), payment_info: info, communication: comm})
                })
                .then(r => r.json())
                .then(d => { loading = false; if(d.success) { showToast(d.message); setTimeout(() => location.reload(), 1500); } else showToast(d.error, true); })
                .catch(() => { loading = false; showToast('–û—à–∏–±–∫–∞', true); })
            ">
        <span x-show="!loading">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</span>
        <span x-show="loading">–û—Ç–ø—Ä–∞–≤–∫–∞...</span>
    </button>
</div>
{% endif %}
{% endblock %}
